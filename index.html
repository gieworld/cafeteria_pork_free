<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIT Pork-Free Menu</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" href="app-icon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-pattern: repeating-linear-gradient(45deg, #e5e5e5 25%, transparent 25%, transparent 75%, #e5e5e5 75%, #e5e5e5), repeating-linear-gradient(45deg, #e5e5e5 25%, #ffffff 25%, #ffffff 75%, #e5e5e5 75%, #e5e5e5);
        }

        body {
            background-color: #ffffff;
            background-image: radial-gradient(#aaa 15%, transparent 16%), radial-gradient(#aaa 15%, transparent 16%);
            background-size: 4px 4px;
            background-position: 0 0, 2px 2px;
            color: #000;
            font-family: 'VT323', monospace;
        }

        /* Chicago-style Window */
        .mac-window {
            background: #fff;
            border: 2px solid #000;
            box-shadow: 4px 4px 0px #000;
            margin-bottom: 24px;
        }

        /* Title Bar with Stripes */
        .title-bar {
            border-bottom: 2px solid #000;
            padding: 4px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: repeating-linear-gradient(180deg,
                    #000,
                    #000 1px,
                    #fff 1px,
                    #fff 2px);
        }

        .title-text {
            background: #fff;
            padding: 0 12px;
            font-size: 1.25rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* Retro Tabs */
        .retro-tab {
            border: 2px solid #000;
            background: #fff;
            margin-right: -2px;
            /* Connect them */
            padding: 4px 12px;
            font-size: 1.1rem;
            cursor: pointer;
            position: relative;
        }

        .retro-tab:hover {
            background: #ddd;
        }

        .retro-tab.active {
            background: #000;
            color: #fff;
            z-index: 10;
        }

        /* Content Area */
        .content-area {
            padding: 16px;
        }

        .alert-box {
            border: 2px solid #000;
            padding: 12px;
            margin-bottom: 16px;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border: 1px solid #000;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .badge-safe {
            background-color: #fff;
            color: #000;
            border: 2px solid #000;
        }

        .badge-warn {
            background-color: #ddd;
            color: #000;
            border: 2px solid #000;
            border-style: dotted;
        }

        .badge-danger {
            background-color: #000;
            color: #fff;
            border: 2px solid #000;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body class="p-4 min-h-screen flex flex-col items-center justify-start">

    <!-- System 7 Window Frame -->
    <div class="mac-window w-full max-w-2xl relative bg-white">

        <!-- Title Bar -->
        <div class="title-bar">
            <span class="title-text">üçΩÔ∏è KIT Pork-Free Guide</span>
        </div>

        <!-- App Header Info -->
        <div class="border-b-2 border-black p-3 bg-white flex justify-between items-center">
            <div class="text-lg">System: <span class="font-bold">KIT Cafeteria</span></div>
            <div id="update-time" class="text-sm border border-black px-2 py-1">Loading...</div>
        </div>

        <!-- Navigation (Tabs) -->
        <nav class="flex p-3 pb-0 border-b-2 border-black bg-gray-100 overflow-x-auto">
            <button onclick="switchTab('Monday')" id="tab-Monday" class="retro-tab">MON</button>
            <button onclick="switchTab('Tuesday')" id="tab-Tuesday" class="retro-tab">TUE</button>
            <button onclick="switchTab('Wednesday')" id="tab-Wednesday" class="retro-tab">WED</button>
            <button onclick="switchTab('Thursday')" id="tab-Thursday" class="retro-tab">THU</button>
            <button onclick="switchTab('Friday')" id="tab-Friday" class="retro-tab">FRI</button>
        </nav>

        <!-- Main Content (White Canvas) -->
        <main id="content" class="content-area min-h-[400px]">
            <div id="loading" class="text-center py-20 text-xl animate-pulse">
                [ READING DISK... ]
            </div>
            <div id="error-msg" class="hidden text-center py-20 text-red-600 font-bold border-2 border-red-600 m-4 p-4">
                ‚ö† SYSTEM ERROR: FAILED TO LOAD DATA.
            </div>
        </main>

        <!-- Footer -->
        <footer class="border-t-2 border-black p-2 text-center text-sm bg-gray-100">
            <p>‚ö†Ô∏è GUIDE ONLY. NOT CERTIFIED.</p>
            <p class="text-xs mt-1">KIT Pork-Free v2.0 (System 7 Edition)</p>
        </footer>
    </div>

    <script>
        let menuData = {};
        const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];
        const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });

        async function loadData() {
            try {
                // Determine base URL (GitHub Pages uses repository name)
                const response = await fetch('data/menu_data.json?v=' + new Date().getTime());
                if (!response.ok) throw new Error("No data file");

                const data = await response.json();
                menuData = data.week_data;

                document.getElementById('update-time').innerText = "Updated: " + new Date(data.updated_at).toLocaleDateString();
                document.getElementById('loading').classList.add('hidden');

                // Switch to today or Monday if weekend
                const startDay = days.includes(today) ? today : "Monday";
                switchTab(startDay);

            } catch (e) {
                console.error(e);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error-msg').classList.remove('hidden');
            }
        }

        function switchTab(day) {
            // Update Tabs
            days.forEach(d => {
                const btn = document.getElementById(`tab-${d}`);
                if (d === day) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            renderMenu(day);
        }

        function renderMenu(day) {
            const container = document.getElementById('content');
            container.innerHTML = ""; // Clear existing

            const dayData = menuData[day];

            if (!dayData) {
                container.innerHTML = `<div class="text-center py-10 text-gray-500">No data available for ${day}</div>`;
                return;
            }

            dayData.cafeterias.forEach(cafe => {
                const card = document.createElement('div');
                card.className = 'mac-window mb-6'; // Inner windows

                let hasContent = false;

                // Inner Title Bar
                let html = `
                <div class="title-bar" style="height: 24px; padding: 2px;">
                    <span class="title-text" style="font-size: 1rem; padding: 0 8px;">${cafe.name}</span>
                </div>
                <div class="p-4">
                `;

                if (cafe.type === 'individual') {
                    // A La Carte
                    if (cafe.safe_options && cafe.safe_options.length > 0) {
                        html += `<div class="mb-3"><span class="badge badge-safe">SAFE OPTIONS</span></div>`;
                        html += `<ul class="list-square ml-5 space-y-2 mb-4">`;
                        cafe.safe_options.forEach(item => {
                            html += `<li>${item}</li>`;
                        });
                        html += `</ul>`;
                        hasContent = true;
                    }
                    if (cafe.avoid && cafe.avoid.length > 0) {
                        html += `<div class="mb-3"><span class="badge badge-danger">CONTAINS PORK</span></div>`;
                        html += `<ul class="list-square ml-5 space-y-2">`;
                        cafe.avoid.forEach(item => {
                            html += `<li>${item}</li>`;
                        });
                        html += `</ul>`;
                        hasContent = true;
                    }
                } else {
                    // Package Meals
                    cafe.meals.forEach(meal => {
                        let badgeClass = 'badge-danger';
                        let badgeText = 'PORK !!';

                        if (meal.verdict === 'SAFE') {
                            badgeClass = 'badge-safe';
                            badgeText = 'SAFE';
                        } else if (meal.verdict === 'WORTH IT') {
                            badgeClass = 'badge-warn';
                            badgeText = 'MAYBE';
                        } else if (meal.verdict === 'NONE') {
                            return; // Skip empty meals
                        }

                        hasContent = true;
                        html += `
                        <div class="mb-6 border-b-2 border-dashed border-black pb-4 last:border-0 last:pb-0">
                            <div class="flex justify-between items-start mb-2">
                                <span class="font-bold uppercase bg-black text-white px-2 py-0.5">${meal.time}</span>
                                <span class="badge ${badgeClass}">${badgeText}</span>
                            </div>
                            <div class="text-xl mb-2">${meal.main_dish || 'No info'}</div>
                            
                            ${meal.safe_items && meal.safe_items.length ?
                                `<div class="text-sm mt-1">üëç ${meal.safe_items.join(', ')}</div>` : ''}
                            
                            ${meal.skip_items && meal.skip_items.length ?
                                `<div class="text-sm mt-1 font-bold">üõë SKIP: ${meal.skip_items.join(', ')}</div>` : ''}
                        </div>`;
                    });
                }

                if (!hasContent) {
                    html += `<div class="text-center py-4 border-2 border-dotted border-gray-400">[ NO DATA ]</div>`;
                }

                html += `</div>`; // Close content div

                card.innerHTML = html;
                container.appendChild(card);
            });
        }

        // Start
        loadData();
    </script>
</body>

</html>